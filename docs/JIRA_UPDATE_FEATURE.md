# Jira Update Feature

## Overview

The Agentic AI system can now **update Jira issues directly** with the analysis results. This feature posts a comprehensive comment to the Jira issue containing:

- üîç **Pseudo Code** - Complete implementation algorithm in a single BEGIN/END block
- üíª **Source Code Summary** - List of generated files and required dependencies
- üìä **Effort Estimation Table** - Detailed task breakdown with hours, days, and complexity

## How It Works

### 1. Interactive Mode (run.py)

When you run `python run.py`, you'll be prompted:

```
Update Jira issue with analysis? (y/n) [default: n]:
```

If you answer `y`, the system will:
1. Analyze the Jira issue
2. Generate pseudo code, source code, and effort estimates
3. **Append pseudo code to the issue's description field** (preserves original description)
4. Save the full report to `output/` directory
5. Post a comment to the Jira issue with the effort estimation

### 2. Programmatic Usage

```python
from src.agent import JiraAnalysisAgent
from src.config import AgentConfig

# Setup
config = AgentConfig(language="angular", max_days=3.0)
agent = JiraAnalysisAgent(config)

# Analyze
result = agent.analyze_issue(issue_id="DL-61404")

# Generate local report
agent.generate_report(result, output_filename="report.md")

# Update Jira with analysis (and optionally assign to developer)
success = agent.update_jira_with_analysis(
    result=result,
    assign_to="developer@example.com"  # Optional: assign issue to developer
)
```

### 3. With Additional Parameters

For GitHub, GitLab, or Azure DevOps:

```python
agent.update_jira_with_analysis(
    result=result,
    repository_name="my-repo",
    repository_organization="my-org",
    azure_organization="my-azure-org",
    azure_project="my-project",
    assign_to="developer@example.com"  # Optional: assign to developer
)
```

## Comment Format

The system updates the Jira issue in two ways:

### 1. Description Field (Updated)
The pseudo code is **appended** to the existing issue description with a separator:

```markdown
[Original Issue Description]

---

### üîç Pseudo Code (Complexity: Complex)

**Implementation Algorithm**

```
BEGIN
  // Input Validation & Prerequisites
  ...
  
  // Main Logic Flow
  ...
  
  // Success Handling
  ...
  
  // Error Handling
  ...
END
```

**Implementation Notes:**
- Note 1
- Note 2
```

### 2. Comment (Added)
A separate comment is posted with the effort estimation:

```markdown
## ü§ñ AI-Generated Analysis

###  Effort Estimation

| Task | Hours | Days | Complexity |
|------|-------|------|------------|
| Analysis & Technical Design | 2.94 | 0.37 | Complex |
| Implementation (ANGULAR) | 6.46 | 0.81 | Complex |
| Unit Testing | 2.94 | 0.37 | Complex |
| Code Review & Fixes | 1.10 | 0.14 | Complex |
| Documentation | 1.10 | 0.14 | Complex |
| Integration & E2E Testing | 1.47 | 0.18 | Complex |
| **TOTAL** | **16.01** | **2.00** | |
| **WITH BUFFER (20%)** | **19.21** | **2.40** | |

_Generated by Agentic AI System_
```

## Benefits

1. **Preserved Context** - Original issue description remains intact with pseudo code appended
2. **Team Visibility** - Everyone on the Jira issue can see the analysis without accessing external files
3. **Traceability** - Analysis is permanently attached to the issue in the description
4. **Quick Review** - Pseudo code is visible in the main description field
5. **Effort Summary** - Effort estimates posted as a comment for easy tracking
6. **No File Sharing** - No need to share Markdown files via email or Slack
7. **Audit Trail** - Jira automatically tracks who posted the analysis and when
8. **Auto-Assignment** - Optionally assign the issue to a developer during the update process

## API Integration

The feature uses the GitKraken MCP Server's issues API:

```python
# Internal implementation (handled automatically)
mcp_gitkraken_issues_add_comment(
    provider="jira",  # or "github", "gitlab", "azure"
    issue_id="DL-61404",
    comment=formatted_comment,
    # Optional provider-specific params
)
```

## Configuration

No additional configuration needed! The feature uses your existing MCP setup:

- Jira credentials from `.env` or MCP configuration
- Provider specified in `AgentConfig` (defaults to "jira")
- Supports multiple providers: Jira, GitHub Issues, GitLab Issues, Azure DevOps Work Items

## Examples

See:
- `example_jira_update.py` - Full example script
- `run.py` - Interactive mode with Jira update option
- `README.md` - Complete usage documentation

## Notes

- The pseudo code is **appended to the issue description** (original description is preserved)
- A horizontal separator (`---`) is added between the original and pseudo code sections
- The full source code files are NOT posted to Jira (they can be very long)
- The effort estimation is posted as a separate comment for easy tracking
- The complete report is always saved to `output/` directory as a Markdown file
- Pseudo code is formatted in a single BEGIN/END block for easy reading
